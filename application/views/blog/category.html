<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <title>Data-Table 表格</title>
    <link rel="stylesheet" href="/static/lib/frame/layui/css/layui.css">
    <link rel="stylesheet" href="/static/lib/frame/static/css/style.css">
    <link rel="icon" href="/static/images/logo.png">
</head>
<body class="body">

<!-- 工具集 -->
<div class="my-btn-box">
    <span class="fl">
        <a class="layui-btn btn-add btn-default" id="btn-add">添加</a>
        <a class="layui-btn btn-add btn-default" id="btn-refresh"><i class="layui-icon">&#x1002;</i></a>
    </span>
    <span class="fr">
        <span class="layui-form-label">搜索条件：</span>
        <div class="layui-input-inline">
            <input type="text" autocomplete="off" placeholder="请输入搜索条件" class="layui-input">
        </div>
        <button class="layui-btn mgl-20">查询</button>
    </span>
</div>

<!-- 表格 -->
<table id="datalist" lay-filter="tabledata"></table>

<!-- 新增模态框 -->
<div style="display: none;" id="add-model">
    <form class="layui-form" lay-filter="catalogs" style="padding: 15px">
        <div class="layui-form-item">
            <label class="layui-form-label">分类</label>
            <div class="layui-input-block">
                <input id="title" type="text" name="title" placeholder="分类名称" autocomplete="off" class="layui-input">
            </div>
        </div>
        
        <div class="layui-form-item">
            <label class="layui-form-label">相关标签</label>
            <div class="layui-input-block">
                <input id="tags" type="text" name="tags" placeholder="相关标签 , 间隔" autocomplete="off" class="layui-input">
            </div>
        </div>

        <div class="layui-form-item">
            <div class="layui-input-block">
                <button class="layui-btn" lay-submit lay-filter="addcategory">立即提交</button>
                <button type="reset" class="layui-btn layui-btn-primary">重置</button>
            </div>
        </div>
    </form>
</div>

<!-- 编辑模态框 -->
<div style="display: none;" id="update-model">
    <form class="layui-form" lay-filter="catalogs" style="padding: 15px">
        <input type="hidden" id="update_id" name="update_id"> <!-- id -->
        <div class="layui-form-item">
            <label class="layui-form-label">分类</label>
            <div class="layui-input-block">
                <input id="update_title" type="text" name="update_title" placeholder="分类名称" autocomplete="off" class="layui-input">
            </div>
        </div>
        
        <div class="layui-form-item">
            <label class="layui-form-label">相关标签</label>
            <div class="layui-input-block">
                <input id="update_tags" type="text" name="update_tags" placeholder="相关标签 , 间隔" autocomplete="off" class="layui-input">
            </div>
        </div>

        <div class="layui-form-item">
            <div class="layui-input-block">
                <button class="layui-btn" lay-submit lay-filter="updatecategory">立即提交</button>
                <button type="reset" class="layui-btn layui-btn-primary">重置</button>
            </div>
        </div>
    </form>
</div>

<!-- 编辑选项 -->
<div style="display: none;" id="barDo">
  <a style="line-height: 28px;" class="layui-btn layui-btn-xs" id="btn-update" lay-event="edit">编辑</a>
  <a style="line-height: 28px;" class="layui-btn layui-btn-danger layui-btn-xs" lay-event="del">删除</a>
</div>

<script src="/static/lib/frame/layui/layui.js" charset="utf-8"></script>
<script type="text/javascript">
    layui.use(['table', 'layer', 'form'], function(){
        var table = layui.table, $ = layui.jquery, form = layui.form;
        //第一个实例
        table.render({
            elem: '#datalist',
            height: 315,
            url: '/blog/ajaxCategoryList', //数据接口
            page: true, //开启分页
            cols: [[ //表头
                {field: 'id', title: 'ID', width:100, sort: true, fixed: 'left'},
                {field: 'title', title: '分类名称', width:200},
                {field: 'tags', title: '相关标签', width:500},
                {align:'center', fixed: 'right', width:300, toolbar: '#barDo'}
            ]]
        });

        // 页面刷新
        $("[id=btn-refresh]").click(function(){
            window.location.reload();
        });

        // 新增
        $("[id=btn-add]").click(function(){
            layer.open({
                type : 1,
                title : "添加博文分类",
                content : $('#add-model'),
                area : '500px'
            });
        });

        // 编辑
        table.on('tool(tabledata)', function(obj){
            var data = obj.data;
            var layEvent = obj.event;
            if (layEvent=="edit") {
                $.post("/blog/getOneCategory", {id: data.id}, function(json){
                    if (json.state==200) {
                        $("#update_id").val(json.data.id);
                        $("#update_title").val(json.data.title);
                        $("#update_tags").val(json.data.tags);
                        layer.open({
                            type : 1,
                            title : "编辑博文分类",
                            content : $('#update-model'),
                            area : '500px'
                        });
                    }
                }, "json");
            } else if (layEvent === 'del') {
                layer.confirm('真的删除该分类?', function(index){
                    $.post("/blog/deleteCategory", {id: data.id}, function(json){
                        if (json.state==200) {
                            layer.alert(json.message, {title: '提示!'});
                            window.location.reload();
                        }
                    }, "json");
                });
            }
                
        });

        // 新增表单提交
        form.on('submit(addcategory)', function(data){
            $.post("/blog/doCreateCategory", data.field, function(json){
                if (json.state==200) {
                    layer.alert("操作成功!", {title: '提示!'});
                    window.location.reload();
                } else {
                    layer.alert(json.message, {title: '提示!'});
                }
            }, "json");
            return false; //阻止表单跳转
        });

        // 更新表单提交
        form.on('submit(updatecategory)', function(data){
            $.post("/blog/doUpdateCategory", data.field, function(json){
                if (json.state==200) {
                    layer.alert("操作成功!", {title: '提示!'});
                    window.location.reload();
                } else {
                    layer.alert(json.message, {title: '提示!'});
                }
            }, "json");
            return false; //阻止表单跳转
        });
    });
</script>
</body>
</html>